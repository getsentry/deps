{"analyzedAt":"2021-08-16T22:22:48.071Z","collected":{"metadata":{"name":"@sentry-internal/global-search","scope":"sentry-internal","version":"0.1.3","description":"JavaScript library and helper utilities for searching Sentry sites via Algolia.","keywords":["gatsby"],"date":"2021-08-16T22:10:40.781Z","author":{"name":"Sentry"},"publisher":{"username":"sentry-bot","email":"accounts@sentry.io"},"maintainers":[{"username":"haza","email":"daniel.griesser.86@gmail.com"},{"username":"kamilogorek","email":"kamil.ogorek@gmail.com"},{"username":"sentry-bot","email":"accounts@sentry.io"},{"username":"mitsuhiko","email":"armin.ronacher@active-4.com"},{"username":"zeeg","email":"dcramer@gmail.com"},{"username":"leedongwei","email":"danny@dongwei.li"},{"username":"evanpurkhiser","email":"evanpurkhiser@gmail.com"},{"username":"billyvg","email":"npm@mmo.me"},{"username":"jauer","email":"account@jauer.org"},{"username":"markstory","email":"mark@mark-story.com"}],"repository":{"type":"git","url":"git+https://github.com/getsentry/sentry-global-search.git"},"links":{"npm":"https://www.npmjs.com/package/%40sentry-internal%2Fglobal-search","homepage":"https://github.com/getsentry/sentry-global-search#readme","repository":"https://github.com/getsentry/sentry-global-search","bugs":"https://github.com/getsentry/sentry-global-search"},"dependencies":{"@types/dompurify":"^2.0.4","@types/react":">=16","@types/react-dom":">=16","algoliasearch":"^4.3.1","css-select":"^4.1.3","domhandler":"^4.2.0","dompurify":"^2.2.7","htmlparser2":"^4.1.0","title-case":"^3.0.2"},"devDependencies":{"@babel/core":"^7.11.1","@babel/plugin-transform-runtime":"^7.11.0","@babel/preset-env":"^7.11.0","@babel/preset-react":"^7.10.4","@babel/preset-typescript":"^7.10.4","@types/domhandler":"^2.4.2","@types/htmlparser2":"^3.10.3","@types/js-yaml":"^3.12.5","babel-loader":"^8.1.0","css-loader":"^4.2.1","dotenv":"^8.2.0","html-loader":"^1.2.1","html-webpack-plugin":"^4.3.0","jest":"^26.4.1","js-yaml":"^3.14.0","prettier":"2.0.5","prop-types":"^15.7.2","react":"^17.0.2","react-dom":"^17.0.2","remark":"^12.0.1","remark-html":"^12.0.0","sass":"^1.26.10","sass-loader":"^9.0.3","style-loader":"^1.2.1","ts-node":"^9.0.0","typescript":"^4.0.2","webpack":"^4.44.1","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.0","webpack-node-externals":"^2.5.2"},"peerDependencies":{"react":">=16","react-dom":">=16"},"releases":[{"from":"2021-07-17T00:00:00.000Z","to":"2021-08-16T00:00:00.000Z","count":3},{"from":"2021-05-18T00:00:00.000Z","to":"2021-08-16T00:00:00.000Z","count":4},{"from":"2021-02-17T00:00:00.000Z","to":"2021-08-16T00:00:00.000Z","count":11},{"from":"2020-08-16T00:00:00.000Z","to":"2021-08-16T00:00:00.000Z","count":16},{"from":"2019-08-17T00:00:00.000Z","to":"2021-08-16T00:00:00.000Z","count":16}],"hasTestScript":true,"hasSelectiveFiles":true,"readme":"# Global search across Sentry websites\n\n### Table of Contents\n\n| [Sentry Global Search JavaScript Library](#sentry-global-search-javascript-library)                         | [Algolia](#algolia)                                                                                                                                                        |\n| :---------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| [Installation](#installation)<br>[Usage](#usage)<br>[Configuration](#configuration) <br>[Results](#results) | [Constructing Algolia Records](#constructing-algolia-records)<br>[Ranking and Sorting](#ranking-and-sorting)<br>[Index settings](#index-settings)<br>[Synonyms](#synonyms) |\n\n## Sentry Global Search JavaScript Library\n\nThe Sentry Global Search JavaScript libary provides an easy way to query across all Sentry static sites and get consistent, normalized results without needing to worry about Algolia configuration and the complexities of each index. Sources include\n\n- [Docs](https://docs.sentry.io)\n- [Developer docs](https://develop.sentry.dev)\n- [Help center](https://help.sentry.io/)\n- [Blog](https://blog.sentry.io)\n\n### Installation\n\n```\nyarn add @sentry-internal/global-search\n```\n\n### Usage\n\nInitilize the search client with one or more site slugs. The order of the slugs determines the order of results.\n\n```javascript\nimport SentryGlobalSearch from '@sentry-internal/global-search';\n\n// This will include all sites in the results\nconst search = new SentryGlobalSearch([\n  'docs',\n  'develop',\n  'help-center',\n  'blog',\n]);\n\nconst results = await search.query('erlang');\n```\n\n### Configuration\n\nBy default, the SentryGlobalSearch constructor takes an array of slugs matching the supported sites. To provide more flexible options, you may provide an object instead.\n\n```javascript\nconst search = new SentryGlobalSearch([\n  {\n    site: 'docs',\n    pathBias: true,\n  },\n  'develop',\n  'help-center',\n  'blog',\n]);\n```\n\n- `site`: Required String of a valid site slug.\n\n- `pathBias`: Optional Boolean indicating whether to bias path match results if a path is provided to the query. Default: `false`.\n\n- `platformBias`: Optional Boolean indicating whether to bias platform match results if a platform is provided to the query. Default: `true`.\n\n- `legacyBias`: Optional Boolean indicating whether to bias legacy results. Default: `true`.\n\nWhen more than one bias is configured, the following priority is used:\n\n1. Same or child path\n2. Same or parent platform\n3. Everything else\n4. Legacy docs\n\n### Query Options\n\n`query` takes an optional second Object argument which can be used to configure the results.\n\n```javascript\nconst results = await search.query('configuration', {\n  searchAllIndexes: true,\n  platform: 'sentry.erlang',\n});\n```\n\n- `path` — String of a path in the format of `/foo/bar/`. Results with a path matching or subornate will appear first.\n\n- `platform` — String of a valid [SDK slug][sdk-slug-format]. Results matching this slug will appear first or after `path` results.\n\n- `searchAllIndexes` — Boolean, defalt false. Searches all configured indexes if true. Otherwise, search only the first.\n\n### Results\n\nSentryGlobalSearch returns an Array of Site objects and normalizes the list of Hits so that components are straightforward to create. If a site is configured to include results from multiple indexes (for example, during a content migration), those hits will be combined in the final output as a single list of hits for that site.\n\n```json\n[\n  {\n    \"site\": \"docs\",\n    \"name\": \"Documentation\",\n    \"hits\": [\n      {\n        \"id\": \"bbb19a43-5e51-5397-8ba0-9112999b5153\",\n        \"site\": \"site-slug\",\n        \"title\": \"Section within document\",\n        \"text\": \"…snippet text is a paragraph within the document with <mark>content that matches</mark> the provided query…\",\n        \"url\": \"https://result.url#section-within-document\",\n        \"context\": {\n          \"context1\": \"If present, this is the primary context information\",\n          \"context2\": \"If present, this is secondary context information\"\n        }\n      },\n    ]\n  }\n]]\n```\n\n#### Site Object\n\nThe site object is what you'd expect.\n\n- `site` — Slug for the site these results are associated with\n\n- `name` — Human friendly name of the site these results are associated with.\n\n- `hits` — Array of Hit objects representing search results.\n\n#### Hit Object\n\nA hit object contains search data from Algolia, normalized for use in Sentry search. Where indicated, text matching the given query is highlighted with unescaped `mark` tags. All values are strings.\n\n- `id` — objectID from Algolia. Useful as a React `key`.\n\n- `site` — Slug for the site this hit is from.\n\n- `title` - (Highlighted) Title of the hit. Typically, this is the section heading this record is under.\n\n- `context` — Object containing additional detail to contextualize the search result. Varies by site and by record.\n\n  - `context1` — String representing primary context information.\n\n  - `context2` — String representing secondary context information.\n\n- `url` — Url to the match, including a deep link to the section it is in.\n\n## Algolia\n\n### Constructing Algolia Records\n\nWhile not all indexes follow this guide, the preferred strategy for indexing records is thus: Rather than considering an entire document a record, each block level tag (excluding headings) is a record. That is, each paragraph is a record, lists are flattened into single records, etc.\n\nHeadings should not have their own records. They are searchable as the `section` value of other records and are used as the `distinct` value for deduplication.\n\nIdeally, a record object should include the following keys:\n\n#### Searchable Fields\n\n- `section`: `String` — Text of the last heading seen. Initially set to the document title.\n- `text`: `String` — Text content of the record.\n- `keywords`: `[String]` — Specific word a record should be searchable for which may not exist in the section or text.\n\n#### Context Fields\n\n- `title`: `String` — Title of the document this record comes from.\n- `url`: `String` — URL for the document\n- `anchor`: `String` — `id` attribute matching `section` heading, for deep linking.\n\n#### Ranking Fields\n\n- `platforms`: `[String]` — SDK slugs for [platform sorting](#sorting-by-platform).\n- `pathSegments`: `[String]` — Segemented of the document path for [path sorting](#sorting-by-path).\n- `position`: `Number` — Position in the document. Starts at 0, increments for each record.\n- `sectionRank`: `Number` — Rank of header. H1: 100, H2: 90, H3: 80.\n- `legacy`: `Boolean` — Indicates whether this is a record within a legacy document.\n\n### Ranking and Sorting\n\n#### Ranking\n\nResults are ranked using Algolia's built in algorithm. Ties are broken using the following prioritization: `section` > `keywords` > `text`.\n\n#### Sorting by Path\n\nIn some cases, we may wish to float results of pages that are subbordinate to the current page higher than pages elsewhere in a site. That is, when on `/foo/` results for `/foo/bar/` should appear before results on `/bat/`.\n\nTo do this, each record includes a `pathSegments` array, containing all parent paths. For example, a record for `/foo/bar/` will look like:\n\n```JavaScript\npathSegments: [\n  '/foo/'\n  '/foo/bar/'\n]\n```\n\nWhen doing a search while on the page `/foo/`, we tell Algolia to put all records containing a `/foo/` path segment first in the list.\n\n#### Sorting by Platform\n\nIn most cases, searches are done in the context of a specific platform. We float the results from a given platform to the top of the list by indexing a record’s applicable platforms and then using Algolias `optionalFilters` to request the appropriate platform results. Additionally, we want a platform’s family results to also be promoted, for example, we should show JavaScript results under React results if the priority is React.\n\nRecords include a `platforms` array which includes applicable [SDK slugs][sdk-slug-format]. The format is `entity.ecosystem[.flavor]`, and the platforms list includes slugs for the parents of a SDK in addition to the SDK itself. That is, a React record looks like:\n\n```JavaScript\nplatforms: [\n  'sentry',\n  'sentry.javascript',\n  'sentry.javascript.react',\n]\n```\n\nUsing this list, we can prioritize our results as such:\n\n- Put all records matching `sentry.javascript.react` first.\n- Show results which contain `sentry.javascript` next.\n- Show everything else last.\n\nBy including the `entity` portion of the SDK slug, we also give ourselves the ability to filter 1st party SDKs higher than 3rd party SDKs.\n\n#### Sorting By legacy\n\nLegacy docs should be searchable, but they should appear last. Records include a `legacy` value which allows for sorting them last.\n\n[sdk-slug-format]: https://develop.sentry.dev/sdk/event-payloads/types/#clientsdkinfo\n\n#### Ranking by Position\n\nWe consider a match at the top of the document more important than a match at the bottom of a document.\n\n#### Ranking by Section Rank\n\nWe consider a match inside an H1 more important than a match inside an H3.\n\n### Index Settings\n\nIf an index follows the record structure presented above, it should also use the preferred [Algolia index settings](src/sentry-algolia-index-settings.js).\n\n### Synonyms\n\nSynonyms can be configured in the [Algolia Synonym Config](src/algolia-synonyms.yml). This is used to tell Algolia that \"C#\" and \"csharp\" are the same, or that a search for \"Cocoa\" should show results for both \"Swift\" and \"Objective-C\". We also use it to catch common misspellings, so that a search for \"reach\" will also include \"React\" results."},"npm":{"downloads":[{"from":"2021-08-15T00:00:00.000Z","to":"2021-08-16T00:00:00.000Z","count":64},{"from":"2021-08-09T00:00:00.000Z","to":"2021-08-16T00:00:00.000Z","count":1424},{"from":"2021-07-17T00:00:00.000Z","to":"2021-08-16T00:00:00.000Z","count":10124},{"from":"2021-05-18T00:00:00.000Z","to":"2021-08-16T00:00:00.000Z","count":32123},{"from":"2021-02-17T00:00:00.000Z","to":"2021-08-16T00:00:00.000Z","count":65441},{"from":"2020-08-16T00:00:00.000Z","to":"2021-08-16T00:00:00.000Z","count":104511}],"dependentsCount":0,"starsCount":0},"github":{"homepage":"https://sentry-algolia.sentry.dev","starsCount":2,"forksCount":2,"subscribersCount":11,"issues":{"count":21,"openCount":2,"distribution":{"3600":7,"10800":1,"32400":0,"97200":1,"291600":1,"874800":3,"2624400":5,"7873200":3,"23619600":0,"70858800":0,"212576400":0},"isDisabled":false},"contributors":[{"username":"EvanPurkhiser","commitsCount":27},{"username":"cameronmcefee","commitsCount":129},{"username":"kamilogorek","commitsCount":1}],"commits":[{"from":"2021-08-09T00:00:00.000Z","to":"2021-08-16T00:00:00.000Z","count":5},{"from":"2021-07-17T00:00:00.000Z","to":"2021-08-16T00:00:00.000Z","count":13},{"from":"2021-05-18T00:00:00.000Z","to":"2021-08-16T00:00:00.000Z","count":17},{"from":"2021-02-17T00:00:00.000Z","to":"2021-08-16T00:00:00.000Z","count":49},{"from":"2020-08-16T00:00:00.000Z","to":"2021-08-16T00:00:00.000Z","count":124}],"statuses":[{"context":"Vercel","state":"success"}]},"source":{"files":{"readmeSize":9853,"testsSize":16123},"linters":["prettier"],"outdatedDependencies":{"htmlparser2":{"required":"^4.1.0","stable":"6.1.0","latest":"6.1.0"}}}},"evaluation":{"quality":{"carefulness":0.295,"tests":0.85,"health":0.25925925925925924,"branding":0},"popularity":{"communityInterest":18,"downloadsCount":10707.666666666666,"downloadsAcceleration":32.091191019786905,"dependentsCount":0},"maintenance":{"releasesFrequency":1,"commitsFrequency":1,"openIssues":1,"issuesDistribution":1}},"score":{"final":0.5506901804875083,"detail":{"quality":0.5841564781383902,"popularity":0.07269496298854647,"maintenance":1}}}